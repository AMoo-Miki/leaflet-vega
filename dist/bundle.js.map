{"version":3,"file":"bundle.js","sources":["../node_modules/vega-spec-injector/es/index.js","../src/VegaLayer.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _class = function () {\n  function _class(onWarning) {\n    _classCallCheck(this, _class);\n\n    this.onWarning = onWarning || (console ? console.log : function () {});\n  }\n\n  /**\n   * Add values like signals to a vega spec, or ignore if the they are already defined.\n   * @param {object} spec vega spec to modify and return\n   * @param {string} field name of the vega spec branch, e.g. `signals`\n   * @param {<object|string>[]} values to add\n   * @return {object} returns the same spec object as passed in\n   */\n\n\n  _class.prototype.addToList = function addToList(spec, field, values) {\n    var newSigs = new Map(values.map(function (v) {\n      return typeof v === \"string\" ? [v, { name: v }] : [v.name, v];\n    }));\n\n    for (var _iterator = this.findUndefined(spec, field, newSigs.keys()), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var sig = _ref;\n\n      spec[field].push(newSigs.get(sig));\n    }\n\n    return spec;\n  };\n\n  /**\n   * Set a spec field, and warn if overriding an existing value in that field\n   * @param {object} spec vega spec to modify and return\n   * @param {string} field\n   * @param {*} value\n   * @return {object} returns the same spec object as passed in\n   */\n\n\n  _class.prototype.overrideField = function overrideField(spec, field, value) {\n    if (spec[field] && spec[field] !== value) {\n      this.onWarning(\"Overriding \" + field + \": \" + spec[field] + \" \\uD800\\uDCD8 \" + value);\n    }\n    spec[field] = value;\n    return spec;\n  };\n\n  /**\n   * Find all names that are not defined in the spec's section. Creates section if missing.\n   * @param {object} spec\n   * @param {string} section\n   * @param {Iterable.<string>} names\n   * @return {Iterable.<string>}\n   */\n\n\n  _class.prototype.findUndefined = function findUndefined(spec, section, names) {\n    if (!spec.hasOwnProperty(section)) {\n      spec[section] = [];\n      return names;\n    } else if (!Array.isArray(spec[section])) {\n      throw new Error(\"spec.\" + section + \" must be an array\");\n    }\n\n    var nameStrings = new Set(names);\n    for (var _iterator2 = spec[section], _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n\n      var obj = _ref2;\n\n      // If obj has a name field, delete that name from the names\n      // Set will silently ignore delete() for undefined names\n      if (obj.name) nameStrings.delete(obj.name);\n    }\n\n    return nameStrings;\n  };\n\n  return _class;\n}();\n\nexport default _class;","import { version } from '../package.json';\nimport Vsi from 'vega-spec-injector';\nimport L from 'leaflet';\n\nL.vega = function (spec, options) {\n  return new L.VegaLayer(spec, options);\n};\n\nL.VegaLayer = (L.Layer ? L.Layer : L.Class).extend({\n\n  options: {\n    // FIXME: uses window.vega\n    vega: window && window.vega,\n\n    // If Vega spec creates controls (inputs), put them all into this container\n    bindingsContainer: undefined,\n\n    // Options to be passed to the Vega`s parse method\n    parseConfig: undefined,\n\n    // Options to be passed ot the Vega`s View constructor\n    viewConfig: undefined,\n\n    // If true, graph will be repainted only after the map has finished moving (faster)\n    delayRepaint: true,\n\n    // optional warning handler:   (warning) => { ... }\n    onWarning: false,\n\n    // optional error handler:   (err) => { ...; throw err; }\n    onError: false,\n  },\n\n  initialize: function (spec, options) {\n    L.Util.setOptions(this, options);\n\n    // expression parsing in Vega is global,\n    // ensure it hasn't been intialized before,\n    // and make sure calls to setMapView() only happen\n    // when the View instance was created by us\n    const vega = this.options.vega;\n    if (!vega.expressionFunction('setMapView')) {\n      vega.expressionFunction('setMapView',\n        function () {\n          const handler = this.context.dataflow.Leaflet_setMapViewHandler;\n          if (!handler) throw new Error('setMapView() is not defined for this graph');\n          return handler(...arguments);\n        });\n    }\n    this._ignoreSignals = 0;\n    this.disableSignals = () => {\n      this._ignoreSignals++;\n    };\n    this.enableSignals = () => {\n      this._ignoreSignals--;\n      if (this._ignoreSignals < 0) {\n        this._ignoreSignals = 0;\n        throw new Error(`Too many calls to enableSignals()`);\n      }\n    };\n\n    // Inject signals into the spec\n    const vsi = new Vsi(options.onWarning);\n\n    vsi.overrideField(spec, `padding`, 0);\n    vsi.overrideField(spec, `autosize`, `none`);\n    vsi.addToList(spec, `signals`, [`zoom`, `latitude`, `longitude`]);\n    vsi.addToList(spec, `projections`, [this.defaultProjection]);\n\n    this._spec = spec;\n  },\n\n  /**\n   * @param {L.Map} map\n   * @return {L.VegaLayer}\n   */\n  addTo: function (map) {\n    map.addLayer(this);\n    return this;\n  },\n\n  onAdd: function (map) {\n    this._onAddAsync(map);\n    return this;\n  },\n\n  _onAddAsync: async function (map) {\n    this.disableSignals();\n\n    try {\n      this._map = map;\n      this._vegaContainer = L.DomUtil.create(`div`, `leaflet-vega-container`);\n      map._panes.overlayPane.appendChild(this._vegaContainer);\n\n      const vega = this.options.vega;\n\n      const dataflow = vega.parse(this._spec, this.options.parseConfig);\n\n      const viewConfig = this.options.viewConfig;\n      if (viewConfig && viewConfig.loader) {\n        const oldLoad = viewConfig.loader.load.bind(viewConfig.loader);\n        viewConfig.loader.load = (uri, opt) => {\n          return oldLoad(uri, opt);\n        };\n      }\n      this._view = new vega.View(dataflow, viewConfig);\n\n      if (!viewConfig || viewConfig.logLevel === undefined) {\n        this._view.logLevel(vega.Warn);\n      }\n      if (this.options.onWarning) {\n        this._view.warn = this.options.onWarning;\n      }\n      if (this.options.onError) {\n        this._view.error = this.options.onError;\n      }\n\n      this._view\n        .padding({ left: 0, right: 0, top: 0, bottom: 0 })\n        .initialize(this._vegaContainer, this.options.bindingsContainer)\n        .hover();\n\n      const onSignal = (sig, value) => this._onSignalChange(sig, value);\n\n      this._view\n        .addSignalListener(`latitude`, onSignal)\n        .addSignalListener(`longitude`, onSignal)\n        .addSignalListener(`zoom`, onSignal);\n\n      map.on(this.options.delayRepaint ? `moveend` : `move`, () => this._resetAsync());\n      map.on(`zoomend`, () => this._resetAsync());\n\n    /**\n     * Given longitude/latitude/zoom or bounding box, position the map to those coordinates\n     * The function can be called in one of the following ways:\n     *  setMapView(latitude, longitude)\n     *  setMapView(latitude, longitude, zoom)\n     *  setMapView([longitude, latitude])\n     *  setMapView([longitude, latitude], zoom)\n     *  setMapView([[lng1,lat1],[lng2,lat2]])\n     */\n      this._view.Leaflet_setMapViewHandler = (...args) => {\n\n        function throwError() {\n          throw new Error(`Unexpected setMapView() parameters -- it could be called with a bounding box setMapView([[longitude1,latitude1],[longitude2,latitude2]]), or it could be the center point setMapView([longitude, latitude], optional_zoom), or it can be used as setMapView(latitude, longitude, optional_zoom)`);\n        }\n\n        function checkArray(val) {\n          if (!Array.isArray(val) || val.length !== 2 ||\n            typeof val[0] !== 'number' || typeof val[1] !== 'number'\n          ) {\n            throwError();\n          }\n          return val;\n        }\n\n        let lng, lat, zoom;\n        switch (args.length) {\n          default:\n            throwError();\n            break;\n          case 1: {\n            const arg = args[0];\n            if (Array.isArray(arg) && arg.length === 2 && Array.isArray(arg[0]) && Array.isArray(arg[1])) {\n              // called with a bounding box, need to reverse order\n              let [lng1, lat1] = checkArray(arg[0]);\n              let [lng2, lat2] = checkArray(arg[1]);\n              map.fitBounds(L.latLngBounds(L.latLng(lat1, lng1), L.latLng(lat2, lng2)));\n            } else {\n              // called with a center point and no zoom\n              [lng, lat] = checkArray(arg);\n            }\n            break;\n          }\n          case 2:\n            if (Array.isArray(args[0])) {\n              [lng, lat] = checkArray(args[0]);\n              zoom = args[1];\n            } else {\n              [lat, lng] = args;\n            }\n            break;\n          case 3:\n            [lat, lng, zoom] = args;\n            break;\n        }\n\n        if (lat !== undefined && lng !== undefined) {\n          if (typeof lat !== 'number' || typeof lng !== 'number') {\n            throwError();\n          }\n          if (zoom === undefined) {\n            zoom = map.getZoom();\n          } else if (typeof zoom !== 'number') {\n            throwError();\n          }\n          map.setView({ lat, lng }, zoom);\n        }\n      };\n      await this._resetAsync(true);\n    } catch (err) {\n      if (this.options.onError) {\n        this.options.onError(err);\n      }\n    } finally {\n      this.enableSignals();\n    }\n  },\n\n  onRemove: function () {\n    if (this._view) {\n      this._view.finalize();\n      this._view = null;\n    }\n\n    // TODO: once Leaflet 0.7 is fully out of the picture, replace this with L.DomUtil.empty()\n    const el = this._vegaContainer;\n    while (el.firstChild) {\n      el.removeChild(el.firstChild);\n    }\n  },\n\n  _onSignalChange: function (sig, value) {\n    if (this._ignoreSignals) {\n      return;\n    }\n\n    const map = this._map;\n    let center = map.getCenter();\n    let zoom = map.getZoom();\n\n    switch (sig) {\n      case `latitude`:\n        center.lat = value;\n        break;\n      case `longitude`:\n        center.lng = value;\n        break;\n      case `zoom`:\n        zoom = value;\n        break;\n      default:\n        return; // ignore\n    }\n\n    map.setView(center, zoom);\n  },\n\n  _resetAsync: async function (force) {\n    if (!this._view) return;\n\n    this.disableSignals();\n    try {\n      const map = this._map;\n      const view = this._view;\n      const topLeft = map.containerPointToLayerPoint([0, 0]);\n      L.DomUtil.setPosition(this._vegaContainer, topLeft);\n\n      const size = map.getSize();\n      const center = map.getCenter();\n      const zoom = map.getZoom();\n\n      // Only send changed signals to Vega. Detect if any of the signals have changed before calling run()\n      const sendSignal = (sig, value) => {\n        if (view.signal(sig) !== value) {\n          view.signal(sig, value);\n          return 1;\n        }\n        return 0;\n      };\n\n      let changed = 0;\n      changed |= sendSignal(`width`, size.x);\n      changed |= sendSignal(`height`, size.y);\n      changed |= sendSignal(`latitude`, center.lat);\n      changed |= sendSignal(`longitude`, center.lng);\n      changed |= sendSignal(`zoom`, zoom);\n\n      if (changed || force) {\n        await view.runAsync();\n      }\n    } catch (err) {\n      if (this.options.onError) {\n        this.options.onError(err);\n      } else if (console && console.error) {\n        console.error(err);\n      }\n    } finally {\n      this.enableSignals();\n    }\n  },\n\n  defaultProjection: {\n    name: `projection`,\n    type: `mercator`,\n    scale: { signal: `256*pow(2,zoom)/2/PI` },\n    rotate: [{ signal: `-longitude` }, 0, 0],\n    center: [0, { signal: `latitude` }],\n    translate: [{ signal: `width/2` }, { signal: `height/2` }],\n    fit: false,\n  },\n\n});\n\nL.VegaLayer.version = version;\n"],"names":["L","vega","spec","options","VegaLayer","Layer","Class","extend","window","undefined","Util","setOptions","expressionFunction","handler","context","dataflow","Leaflet_setMapViewHandler","Error","arguments","_ignoreSignals","disableSignals","enableSignals","vsi","Vsi","onWarning","overrideField","addToList","defaultProjection","_spec","map","addLayer","_onAddAsync","_map","_vegaContainer","DomUtil","create","_panes","overlayPane","appendChild","parse","parseConfig","viewConfig","loader","load","bind","uri","opt","oldLoad","_view","View","logLevel","Warn","warn","onError","error","padding","left","right","top","bottom","initialize","bindingsContainer","hover","onSignal","sig","value","_onSignalChange","addSignalListener","on","delayRepaint","_resetAsync","args","throwError","checkArray","val","Array","isArray","length","lng","lat","zoom","arg","lng1","lat1","lng2","lat2","fitBounds","latLngBounds","latLng","getZoom","setView","finalize","el","firstChild","removeChild","center","getCenter","force","containerPointToLayerPoint","setPosition","topLeft","getSize","sendSignal","view","signal","size","x","y","changed","runAsync","console","version"],"mappings":"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"}