{"version":3,"file":"bundle.js","sources":["../node_modules/vega-spec-injector/es/index.js","../src/VegaLayer.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _class = function () {\n  function _class(onWarning) {\n    _classCallCheck(this, _class);\n\n    this.onWarning = onWarning || (console ? console.log : function () {});\n  }\n\n  /**\n   * Add values like signals to a vega spec, or ignore if the they are already defined.\n   * @param {object} spec vega spec to modify and return\n   * @param {string} field name of the vega spec branch, e.g. `signals`\n   * @param {<object|string>[]} values to add\n   * @return {object} returns the same spec object as passed in\n   */\n\n\n  _class.prototype.addToList = function addToList(spec, field, values) {\n    var newSigs = new Map(values.map(function (v) {\n      return typeof v === \"string\" ? [v, { name: v }] : [v.name, v];\n    }));\n\n    for (var _iterator = this.findUndefined(spec, field, newSigs.keys()), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var sig = _ref;\n\n      spec[field].push(newSigs.get(sig));\n    }\n\n    return spec;\n  };\n\n  /**\n   * Set a spec field, and warn if overriding an existing value in that field\n   * @param {object} spec vega spec to modify and return\n   * @param {string} field\n   * @param {*} value\n   * @return {object} returns the same spec object as passed in\n   */\n\n\n  _class.prototype.overrideField = function overrideField(spec, field, value) {\n    if (spec[field] && spec[field] !== value) {\n      this.onWarning(\"Overriding \" + field + \": \" + spec[field] + \" \\uD800\\uDCD8 \" + value);\n    }\n    spec[field] = value;\n    return spec;\n  };\n\n  /**\n   * Find all names that are not defined in the spec's section. Creates section if missing.\n   * @param {object} spec\n   * @param {string} section\n   * @param {Iterable.<string>} names\n   * @return {Iterable.<string>}\n   */\n\n\n  _class.prototype.findUndefined = function findUndefined(spec, section, names) {\n    if (!spec.hasOwnProperty(section)) {\n      spec[section] = [];\n      return names;\n    } else if (!Array.isArray(spec[section])) {\n      throw new Error(\"spec.\" + section + \" must be an array\");\n    }\n\n    var nameStrings = new Set(names);\n    for (var _iterator2 = spec[section], _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n\n      var obj = _ref2;\n\n      // If obj has a name field, delete that name from the names\n      // Set will silently ignore delete() for undefined names\n      if (obj.name) nameStrings.delete(obj.name);\n    }\n\n    return nameStrings;\n  };\n\n  return _class;\n}();\n\nexport default _class;","import { version } from '../package.json';\nimport Vsi from 'vega-spec-injector';\nimport L from 'leaflet';\n\nL.vega = function (spec, options) {\n  return new L.VegaLayer(spec, options);\n};\n\nL.VegaLayer = (L.Layer ? L.Layer : L.Class).extend({\n\n  options: {\n    // FIXME: uses window.vega\n    vega: window && window.vega,\n\n    // If Vega spec creates controls (inputs), put them all into this container\n    bindingsContainer: undefined,\n\n    // Options to be passed to the Vega`s parse method\n    parseConfig: undefined,\n\n    // Options to be passed ot the Vega`s View constructor\n    viewConfig: undefined,\n\n    // If true, graph will be repainted only after the map has finished moving (faster)\n    delayRepaint: true,\n\n    // optional warning handler:   (warning) => { ... }\n    onWarning: false,\n\n    // optional error handler:   (err) => { ...; throw err; }\n    onError: false,\n  },\n\n  initialize: function (spec, options) {\n    L.Util.setOptions(this, options);\n\n    // expression parsing in Vega is global,\n    // ensure it hasn't been intialized before,\n    // and make sure calls to setMapView() only happen\n    // when the View instance was created by us\n    const vega = this.options.vega;\n    if (!vega.expressionFunction('setMapView')) {\n      vega.expressionFunction('setMapView',\n        /**\n         * Given longitude/latitude/zoom, position the map to those coordinates\n         * The function can be called in one of the following ways:\n         *  setMapView(latitude, longitude)\n         *  setMapView(latitude, longitude, zoom)\n         *  setMapView([longitude, latitude])\n         *  setMapView([longitude, latitude], zoom)\n         */\n        function () {\n          const handler = this.context.dataflow.Leaflet_setMapViewHandler;\n          if (!handler) throw new Error('setMapView() is not defined for this graph');\n          let longitude, latitude, zoom;\n\n          function checkArray(val, ind) {\n            if (!val || !Array.isArray(val) || val.length !== 2 ||\n              typeof val[0] !== 'number' || typeof val[1] !== 'number'\n            ) {\n              throw new Error(`setMapView's ${ind} parameter must be a 2 value array [longitude, latitude], or it can be used as setMapView(latitude, longitude, optional_zoom)`);\n            }\n            return val;\n          }\n\n          switch (arguments.length) {\n            default:\n              throw new Error('Unexpected number of setMapView parameters');\n            case 1:\n              [longitude, latitude] = checkArray(arguments[0], '1st');\n              break;\n            case 2:\n              if (Array.isArray(arguments[0])) {\n                [longitude, latitude] = checkArray(arguments[0], '1st');\n                zoom = arguments[1];\n              } else {\n                [latitude, longitude] = arguments;\n              }\n              break;\n            case 3:\n              [latitude, longitude, zoom] = arguments;\n              break;\n          }\n          handler(latitude, longitude, zoom);\n        });\n    }\n\n    this._ignoreSignals = 0;\n    this.disableSignals = () => {\n      this._ignoreSignals++;\n    };\n    this.enableSignals = () => {\n      this._ignoreSignals--;\n      if (this._ignoreSignals < 0) {\n        this._ignoreSignals = 0;\n        throw new Error(`Too many calls to enableSignals()`);\n      }\n    };\n\n    // Inject signals into the spec\n    const vsi = new Vsi(options.onWarning);\n\n    vsi.overrideField(spec, `padding`, 0);\n    vsi.overrideField(spec, `autosize`, `none`);\n    vsi.addToList(spec, `signals`, [`zoom`, `latitude`, `longitude`]);\n    vsi.addToList(spec, `projections`, [this.defaultProjection]);\n\n    this._spec = spec;\n  },\n\n  /**\n   * @param {L.Map} map\n   * @return {L.VegaLayer}\n   */\n  addTo: function (map) {\n    map.addLayer(this);\n    return this;\n  },\n\n  onAdd: function (map) {\n    this._onAddAsync(map);\n    return this;\n  },\n\n  _onAddAsync: async function (map) {\n    this.disableSignals();\n\n    try {\n      this._map = map;\n      this._vegaContainer = L.DomUtil.create(`div`, `leaflet-vega-container`);\n      map._panes.overlayPane.appendChild(this._vegaContainer);\n\n      const vega = this.options.vega;\n\n      const dataflow = vega.parse(this._spec, this.options.parseConfig);\n\n      const viewConfig = this.options.viewConfig;\n      if (viewConfig && viewConfig.loader) {\n        const oldLoad = viewConfig.loader.load.bind(viewConfig.loader);\n        viewConfig.loader.load = (uri, opt) => {\n          return oldLoad(uri, opt);\n        };\n      }\n      this._view = new vega.View(dataflow, viewConfig);\n\n      if (this.options.onWarning) {\n        this._view.warn = this.options.onWarning;\n      }\n\n      if (this.options.onError) {\n        this._view.error = this.options.onError;\n      }\n\n      this._view\n        .padding({ left: 0, right: 0, top: 0, bottom: 0 })\n        .initialize(this._vegaContainer, this.options.bindingsContainer)\n        .hover();\n\n      const onSignal = (sig, value) => this._onSignalChange(sig, value);\n\n      this._view\n        .addSignalListener(`latitude`, onSignal)\n        .addSignalListener(`longitude`, onSignal)\n        .addSignalListener(`zoom`, onSignal);\n\n      map.on(this.options.delayRepaint ? `moveend` : `move`, () => this._resetAsync());\n      map.on(`zoomend`, () => this._resetAsync());\n\n      this._view.Leaflet_setMapViewHandler = (lat, lng, zoom) => {\n        if (zoom === undefined) {\n          zoom = map.getZoom();\n        }\n        map.setView({lat, lng}, zoom);\n        this._resetAsync(); // ignore promise\n      };\n\n      await this._resetAsync(true);\n    } catch (err) {\n      if (this.options.onError) {\n        this.options.onError(err);\n      }\n    } finally {\n      this.enableSignals();\n    }\n  },\n\n  onRemove: function () {\n    if (this._view) {\n      this._view.finalize();\n      this._view = null;\n    }\n\n    // TODO: once Leaflet 0.7 is fully out of the picture, replace this with L.DomUtil.empty()\n    const el = this._vegaContainer;\n    while (el.firstChild) {\n      el.removeChild(el.firstChild);\n    }\n  },\n\n  _onSignalChange: function (sig, value) {\n    if (this._ignoreSignals) {\n      return;\n    }\n\n    const map = this._map;\n    let center = map.getCenter();\n    let zoom = map.getZoom();\n\n    switch (sig) {\n      case `latitude`:\n        center.lat = value;\n        break;\n      case `longitude`:\n        center.lng = value;\n        break;\n      case `zoom`:\n        zoom = value;\n        break;\n      default:\n        return; // ignore\n    }\n\n    map.setView(center, zoom);\n\n    this._resetAsync(); // ignore promise\n  },\n\n  _resetAsync: async function (force) {\n    if (!this._view) return;\n\n    this.disableSignals();\n    try {\n      const map = this._map;\n      const view = this._view;\n      const topLeft = map.containerPointToLayerPoint([0, 0]);\n      L.DomUtil.setPosition(this._vegaContainer, topLeft);\n\n      const size = map.getSize();\n      const center = map.getCenter();\n      const zoom = map.getZoom();\n\n      // Only send changed signals to Vega. Detect if any of the signals have changed before calling run()\n      const sendSignal = (sig, value) => {\n        if (view.signal(sig) !== value) {\n          view.signal(sig, value);\n          return 1;\n        }\n        return 0;\n      };\n\n      let changed = 0;\n      changed |= sendSignal(`width`, size.x);\n      changed |= sendSignal(`height`, size.y);\n      changed |= sendSignal(`latitude`, center.lat);\n      changed |= sendSignal(`longitude`, center.lng);\n      changed |= sendSignal(`zoom`, zoom);\n\n      if (changed || force) {\n        await view.runAsync();\n      }\n    } catch (err) {\n      if (this.options.onError) {\n        this.options.onError(err);\n      }\n    } finally {\n      this.enableSignals();\n    }\n  },\n\n  defaultProjection: {\n    name: `projection`,\n    type: `mercator`,\n    scale: { signal: `256*pow(2,zoom)/2/PI` },\n    rotate: [{ signal: `-longitude` }, 0, 0],\n    center: [0, { signal: `latitude` }],\n    translate: [{ signal: `width/2` }, { signal: `height/2` }],\n    fit: false,\n  },\n\n});\n\nL.VegaLayer.version = version;\n"],"names":["L","vega","spec","options","VegaLayer","Layer","Class","extend","window","undefined","Util","setOptions","expressionFunction","handler","context","dataflow","Leaflet_setMapViewHandler","Error","longitude","latitude","zoom","checkArray","val","ind","Array","isArray","length","arguments","_ignoreSignals","disableSignals","enableSignals","vsi","Vsi","onWarning","overrideField","addToList","defaultProjection","_spec","map","addLayer","_onAddAsync","_map","_vegaContainer","DomUtil","create","_panes","overlayPane","appendChild","parse","parseConfig","viewConfig","loader","load","bind","uri","opt","oldLoad","_view","View","warn","onError","error","padding","left","right","top","bottom","initialize","bindingsContainer","hover","onSignal","sig","value","_onSignalChange","addSignalListener","on","delayRepaint","_resetAsync","lat","lng","getZoom","setView","finalize","el","firstChild","removeChild","center","getCenter","force","containerPointToLayerPoint","setPosition","topLeft","getSize","sendSignal","view","signal","size","x","y","changed","runAsync","version"],"mappings":"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"}